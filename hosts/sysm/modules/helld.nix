{
  config,
  lib,
  nixosModulesPath,
  ...
}:
{
  imports = map (path: nixosModulesPath + path) [
    "/services/networking/cloudflared.nix"
    "/misc/meta.nix"
    "/services/networking/dhcpcd.nix"
    "/config/networking.nix"
    "/config/system-environment.nix"
    "/config/power-management.nix"
    "/system/boot/resolved.nix"
    "/system/boot/networkd.nix"
    "/services/system/dbus.nix"
    "/config/users-groups.nix"
    "/system/boot/systemd/tmpfiles.nix"
    "/config/shells-environment.nix"
    "/config/iproute2.nix"
    "/services/networking/networkmanager.nix"
    "/hardware/all-firmware.nix"
    "/services/networking/modemmanager.nix"
    "/config/resolvconf.nix"
    "/services/networking/wpa_supplicant.nix"
    "/services/networking/iwd.nix"
    "/security/polkit.nix"
    "/security/pam.nix"
    "/tasks/filesystems.nix"
    "/programs/i3lock.nix"
    "/config/console.nix"
    "/services/x11/xserver.nix"
    "/config/fonts/packages.nix"
    "/config/fonts/fontconfig.nix"
    "/services/hardware/bluetooth.nix"
    "/hardware/graphics.nix"
    "/hardware/sensor/iio.nix"
    "/hardware/uinput.nix"
    "/programs/bash/bash.nix"
    "/config/vte.nix"
    "/programs/chromium.nix"
    "/programs/dconf.nix"
    "/programs/evince.nix"
    "/programs/feedbackd.nix"
    "/programs/file-roller.nix"
    "/programs/firefox.nix"
    "/programs/gdk-pixbuf.nix"
    "/programs/geary.nix"
    "/programs/gnome-disks.nix"
    "/programs/gnome-terminal.nix"
    "/programs/gnupg.nix"
    "/programs/kde-pim.nix"
    "/programs/kdeconnect.nix"
    "/programs/wayland/labwc.nix"
    "/programs/nm-applet.nix"
    "/programs/partition-manager.nix"
    "/programs/seahorse.nix"
    "/programs/ssh.nix"
    "/services/printing/cupsd.nix"
    "/programs/system-config-printer.nix"
    "/programs/thunar.nix"
    "/programs/wayland/wayfire.nix"
    "/programs/xfconf.nix"
    "/services/x11/display-managers/lightdm.nix"
    "/programs/xwayland.nix"
    "/programs/zsh/zsh.nix"
    "/config/qt.nix"
    "/security/apparmor.nix"
    "/security" # lsm
    "/security/rtkit.nix"
    "/security/sudo.nix"
    "/security/sudo-rs.nix"
    "/security/wrappers"
    "/services/desktops/accountsservice.nix"
    "/services/hardware/acpid.nix"
    "/services/networking/avahi-daemon.nix"
    "/services/desktops/ayatana-indicators.nix"
    "/services/desktops/bamf.nix"
    "/services/desktops/blueman.nix"
    "/services/x11/colord.nix"
    "/services/desktops/deepin/app-services.nix"
    "/services/desktops/deepin/dde-api.nix"
    "/services/desktops/deepin/dde-daemon.nix"
    "/services/display-managers/default.nix"
    "/services/display-managers/sddm.nix"
    "/services/desktops/dleyna.nix"
    "/services/hardware/fwupd.nix"
    "/services/desktops/geoclue2.nix"
    "/services/desktops/gnome/at-spi2-core.nix"
    "/services/desktops/gnome/evolution-data-server.nix"
    "/services/desktops/gnome/gcr-ssh-agent.nix"
    "/services/desktops/gnome/glib-networking.nix"
    "/services/desktops/gnome/gnome-browser-connector.nix"
    "/services/desktops/gnome/gnome-initial-setup.nix"
    "/services/desktops/gnome/gnome-keyring.nix"
    "/services/desktops/gnome/gnome-online-accounts.nix"
    "/services/desktops/gnome/gnome-remote-desktop.nix"
    "/services/desktops/gnome/gnome-settings-daemon.nix"
    "/services/desktops/gnome/gnome-user-share.nix"
    "/services/desktops/gnome/localsearch.nix"
    "/services/desktops/gnome/rygel.nix"
    "/services/desktops/gnome/sushi.nix"
    "/services/desktops/gnome/tinysparql.nix"
    "/services/misc/graphical-desktop.nix"
    "/services/desktops/gvfs.nix"
    "/services/hardware/bolt.nix"
    "/services/hardware/libinput.nix"
    "/services/accessibility/orca.nix"
    "/services/desktops/pipewire/pipewire.nix"
    "/services/hardware/power-profiles-daemon.nix"
    "/services/networking/rpcbind.nix"
    "/services/accessibility/speechd.nix"
    "/hardware/video/switcheroo-control.nix"
    "/services/misc/sysprof.nix"
    "/services/desktops/system-config-printer.nix"
    "/services/desktops/telepathy.nix"
    "/services/x11/touchegg.nix"
    "/services/desktops/tumbler.nix"
    "/services/hardware/udisks2.nix"
    "/services/hardware/upower.nix"
    "/services/networking/xinetd.nix"
    "/services/desktops/zeitgeist.nix"
    "/system/activation/activation-script.nix"
    "/system/build.nix"
    "/system/activation/top-level.nix"
    "/installer/tools/tools.nix"
    "/misc/man-db.nix"
    "/config/nsswitch.nix"
    "/system/boot/systemd.nix"
  ];
  config = {
    systemd.services = lib.mapAttrs' (
      name: _:
      lib.nameValuePair "cloudflared-tunnel-${name}" {
        wantedBy = lib.mkForce [ "system-manager.target" ];
      }
    ) config.services.cloudflared.tunnels;
  };
}
